"""
K3 — Сортировка слиянием (MergeSort)
--------------------------------------
Принцип (стратегия "Разделяй и властвуй"):
  1. Разделить — делим список пополам до тех пор, пока
     не останутся списки длиной 0 или 1 (они уже отсортированы)
  2. Властвовать — рекурсивно сортируем каждую половину
  3. Объединить (слить) — сливаем две отсортированные половины
     в один отсортированный список

Временная сложность:
  Лучший / Средний / Худший случай — O(n log n)
  (всегда делит пополам и всегда сливает за O(n))

Пространственная сложность: O(n) — вспомогательные списки при слиянии
"""


def merge(left: list, right: list) -> list:
    """
    Сливает два отсортированных списка в один отсортированный.
    Сложность: O(n), где n = len(left) + len(right)
    """
    result = []
    i = 0  # Указатель на текущий элемент левого списка
    j = 0  # Указатель на текущий элемент правого списка

    # Сравниваем элементы обоих списков и берём меньший
    while i < len(left) and j < len(right):
        if left[i] <= right[j]:
            result.append(left[i])   # Берём из левого
            i += 1
        else:
            result.append(right[j])  # Берём из правого
            j += 1

    # Добавляем оставшиеся элементы (один из списков ещё не исчерпан)
    result.extend(left[i:])    # Если остались элементы в левом
    result.extend(right[j:])   # Если остались элементы в правом

    return result


def merge_sort(lst: list) -> list:
    """
    Сортировка слиянием.

    Принимает список, возвращает новый отсортированный список.
    Исходный список не изменяется.
    """
    # Базовый случай: список из 0 или 1 элемента уже отсортирован
    if len(lst) <= 1:
        return lst

    # Делим список пополам
    mid = len(lst) // 2
    left_half  = lst[:mid]    # Левая половина
    right_half = lst[mid:]    # Правая половина

    # Рекурсивно сортируем обе половины
    sorted_left  = merge_sort(left_half)
    sorted_right = merge_sort(right_half)

    # Сливаем две отсортированные половины в одну
    return merge(sorted_left, sorted_right)


# ---------------------------------------------------------------------------
# Демонстрация
# ---------------------------------------------------------------------------
if __name__ == "__main__":
    примеры = [
        [38, 27, 43, 3, 9, 82, 10],
        [5, 4, 3, 2, 1],           # Обратный порядок
        [1],                        # Один элемент
        [],                         # Пустой список
        [7, 7, 7, 2, 2, 1],        # С дубликатами
    ]

    for lst in примеры:
        sorted_lst = merge_sort(lst)
        print(f"merge_sort({lst})")
        print(f"          → {sorted_lst}\n")
