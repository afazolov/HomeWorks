"""
K1 — Рекурсивная функция Фибоначчи + анализ стека вызовов для n = 5
----------------------------------------------------------------------
Числа Фибоначчи: 0, 1, 1, 2, 3, 5, 8, 13, ...
  fib(0) = 0
  fib(1) = 1
  fib(n) = fib(n-1) + fib(n-2)  для n > 1

Стек вызовов для fib(5):
  fib(5)
  ├── fib(4)
  │   ├── fib(3)
  │   │   ├── fib(2)
  │   │   │   ├── fib(1) → 1   (базовый случай)
  │   │   │   └── fib(0) → 0   (базовый случай)
  │   │   └── fib(1) → 1       (базовый случай)
  │   └── fib(2)
  │       ├── fib(1) → 1       (базовый случай)
  │       └── fib(0) → 0       (базовый случай)
  └── fib(3)
      ├── fib(2)
      │   ├── fib(1) → 1       (базовый случай)
      │   └── fib(0) → 0       (базовый случай)
      └── fib(1) → 1           (базовый случай)

Итого вызовов для fib(5): 15
Глубина стека:             5
Временная сложность: O(2ⁿ) — экспоненциальная (каждый вызов порождает два)
Пространственная сложность: O(n) — максимальная глубина стека
"""

# Счётчик для отображения стека вызовов
_depth = 0


def fib(n: int, trace: bool = False) -> int:
    """
    Рекурсивно вычисляет n-е число Фибоначчи.

    Параметры:
        n     — номер числа (начиная с 0)
        trace — если True, выводит дерево вызовов

    Возвращает:
        n-е число Фибоначчи
    """
    global _depth

    if trace:
        print("  " * _depth + f"fib({n})")

    # Базовые случаи: останавливают рекурсию
    if n == 0:
        if trace:
            print("  " * _depth + f"→ 0  (базовый случай)")
        return 0
    if n == 1:
        if trace:
            print("  " * _depth + f"→ 1  (базовый случай)")
        return 1

    # Рекурсивный случай: fib(n) = fib(n-1) + fib(n-2)
    _depth += 1
    left = fib(n - 1, trace)   # Сначала вычисляем fib(n-1)
    _depth -= 1

    _depth += 1
    right = fib(n - 2, trace)  # Затем вычисляем fib(n-2)
    _depth -= 1

    result = left + right
    if trace:
        print("  " * _depth + f"→ fib({n}) = {left} + {right} = {result}")
    return result


# ---------------------------------------------------------------------------
# Демонстрация + анализ стека для n = 5
# ---------------------------------------------------------------------------
if __name__ == "__main__":
    print("=" * 55)
    print("Числа Фибоначчи (fib(0) ... fib(10)):")
    print("=" * 55)
    for i in range(11):
        print(f"  fib({i:>2}) = {fib(i)}")

    print()
    print("=" * 55)
    print("Стек вызовов для fib(5):")
    print("=" * 55)
    _depth = 0
    result = fib(5, trace=True)
    print(f"\nОтвет: fib(5) = {result}")
